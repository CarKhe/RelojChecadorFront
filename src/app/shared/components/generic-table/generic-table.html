<!-- Campo de búsqueda -->
@if (filtro) {
    <mat-form-field appearance="outline" class="buscador">
        <mat-label>Buscar</mat-label>
        <input matInput [(ngModel)]="filtroTexto" (keyup)="aplicarFiltro()" placeholder="Escribe para filtrar..." />
    
        @if(filtroTexto){
            <app-generic-button type="icon" icon="close" matSuffix (click)="filtroTexto=''; aplicarFiltro()" />
        }
    </mat-form-field>
}

<table mat-table [dataSource]="_dataSource" class="mat-elevation-z1 full-width-table">
  <!-- Columnas dinámicas -->
  @for (col of columns; track col.field) {
    <ng-container [matColumnDef]="col.field">
      <th mat-header-cell *matHeaderCellDef>{{ col.label }}</th>
      <td mat-cell *matCellDef="let element">
        @if(col.pipe){
           @switch(col.pipe){
              @case('customDate'){
                {{ element[col.field] | customDatePipe : col.pipeArgs?.[0] ?? 'DD/MM/YYYY HH:mm'}}
              }
           }
        }
        @else {
          {{ element[col.field] }}
        }
        
      </td>
    </ng-container>
  }

  <!-- Acciones -->
  @if (showActions) {
    <ng-container matColumnDef="actions">
      <th mat-header-cell *matHeaderCellDef>Acciones </th>
      <td mat-cell *matCellDef="let element">
        @for (action of actions; track $index) {
          @if (isVisible(action, element)){
            <app-generic-button  
              [type]="'icon'"
              [icon]="typeof action.icon === 'function' ? action.icon(element) : action.icon"
              [color]="typeof action.color === 'function' ? action.color(element) : action.color"
              (click)="action.onClick(element)"
              [emmit]="false"
            />
          }
        }
      </td>
    </ng-container>
  }

  <!-- Header y body -->
  <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
  <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>

</table>

@if (paginador) {
  <mat-paginator [pageSize]="pageSize" [pageSizeOptions]="pageSizeOptions" showFirstLastButtons></mat-paginator>
}

@if (!data || data.length === 0) {
  <div class="empty-state">No hay registros para mostrar.</div>
}